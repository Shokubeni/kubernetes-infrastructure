{
  "schemaVersion": "2.2",
  "description": "Cluster nodes runtime installation",
  "parameters": {
    "KubernetesVersion": {
      "type": "String"
    },
    "DockerVersion": {
      "type": "String"
    }
  },
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "Installation",
      "inputs": {
        "runCommand": [
          "sudo su",
          "hostnamectl set-hostname $(ec2metadata --local-hostname)",

          "apt-get update",
          "apt-get install -y apt-transport-https ca-certificates curl gnupg-agent software-properties-common",
          "curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -",
          "add-apt-repository \"deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable\"",
          "apt-get update",
          "apt-get install -y docker-ce={{ DockerVersion }}*",

          "sudo apt-get install -y awscli",
          "apt-get update && apt-get install -y apt-transport-https curl",
          "curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | apt-key add - ",
          "echo 'deb https://apt.kubernetes.io/ kubernetes-xenial main' >> /etc/apt/sources.list.d/kubernetes.list",
          "apt-get update",
          "apt-get install -y kubelet kubeadm={{ KubernetesVersion }}* kubectl",
          "apt-mark hold kubelet kubeadm kubectl"
        ]
      }
    }
  ]
}