{
  "schemaVersion": "2.2",
  "description": "Initialize common worker node",
  "parameters": {
    "S3BucketName":{
      "type": "String"
    }
  },
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "Initialization",
      "inputs": {
        "runCommand": [
          "sudo su",

          "cat <<EOF | sudo tee /etc/default/kubelet",
          "KUBELET_EXTRA_ARGS=--cloud-provider=aws",
          "EOF",

          "aws s3 cp s3://{{ S3BucketName }}/commands/join-command ./join-command",
          "sudo $(cat ./join-command)"
        ]
      }
    }
  ]
}