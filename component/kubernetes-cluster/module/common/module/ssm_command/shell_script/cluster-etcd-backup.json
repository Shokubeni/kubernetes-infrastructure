{
  "schemaVersion": "2.2",
  "description": "Backup etcd database",
  "parameters": {
    "CustomResources": {
      "type": "String"
    },
    "BackupsTTL": {
      "type": "String"
    }
  },
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "Backup",
      "inputs": {
        "runCommand": [
          "sudo su",
          "ETCD_BACKUP_DATE=$(date +\"%d.%m.%y-%H.%M.%S\")",
          "velero backup create $ETCD_BACKUP_DATE --ttl {{ BackupsTTL }} --include-resources {{ CustomResources }} --wait --kubeconfig /etc/kubernetes/admin.conf"
        ]
      }
    }
  ]
}
