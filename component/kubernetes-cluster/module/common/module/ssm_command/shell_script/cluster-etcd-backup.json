{
  "schemaVersion": "2.2",
  "description": "Backup etcd database",
  "parameters": {
    "BackupNamespaces": {
      "type": "String"
    },
    "BackupResources": {
      "type": "String"
    },
    "BackupsTTL": {
      "type": "String"
    }
  },
  "mainSteps": [
    {
      "action": "aws:runShellScript",
      "name": "Backup",
      "inputs": {
        "runCommand": [
          "sudo su",
          "export ETCD_BACKUP_DATE=$(date +\"%d.%m.%y-%H.%M.%S\")",
          "export PATH=/root/.linkerd2/bin:/root/bin:$PATH",
          "export HOME=/root",

          "velero backup create $ETCD_BACKUP_DATE --include-namespaces '{{ BackupNamespaces }}' --include-resources '{{ BackupResources }}' --ttl '{{ BackupsTTL }}' --wait"
        ]
      }
    }
  ]
}
